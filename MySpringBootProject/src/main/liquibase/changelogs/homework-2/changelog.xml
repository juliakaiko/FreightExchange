<?xml version="1.0" encoding="UTF-8"?>   
<databaseChangeLog
   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xmlns:pro="http://www.liquibase.org/xml/ns/pro"
   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd
      http://www.liquibase.org/xml/ns/pro 
      http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.1.xsd"
      logicalFilePath="homework-2">  
    
   <changeSet id="homework-2-carrier" author="Julia Kaiko">
        <preConditions>
            <not>
               <tableExists tableName="carrier"/>
            </not>
        </preConditions>
	
       <createTable tableName="carrier">
            <column name="id" type="BIGSERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
	    <column name="name" type="character varying (200)">
                <constraints nullable="false"/>
            </column>
	    <column name="address" type="character varying (200)">
                <constraints nullable="false"/>
            </column>
    	</createTable>
    </changeSet>
    
    <changeSet id="homework-2-carriermanager" author="Julia Kaiko">
        <preConditions>
            <not>
                <tableExists tableName="carriermanager"/>
            </not>
        </preConditions>
	
       <createTable tableName="carriermanager">
            <column name="id" type="BIGSERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
	    <column name="surname" type="character varying (200)">
                <constraints nullable="false"/>
            </column>
	    <column name="firstname" type="character varying (200)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="character varying (200)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="password" type="character varying(200)">
                <constraints nullable="false"/>
            </column>
    	</createTable>
    </changeSet>

    <changeSet id="homework-2-carrier_managers" author="Julia Kaiko">
        <preConditions>
            <not>
                <tableExists tableName="carrier_managers"/>
            </not>
        </preConditions>
	
       <createTable tableName="carrier_managers">
           <!-- <column name="id" type="BIGSERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>-->
            <column name="manager_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="carrier_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
    	</createTable>        
        <addForeignKeyConstraint constraintName="fk_manager"
		baseTableName="carrier_managers" baseColumnNames="manager_id"
		referencedTableName="carriermanager" referencedColumnNames="id" />
	<addForeignKeyConstraint constraintName="fk_carrier "
		baseTableName="carrier_managers" baseColumnNames="carrier_id"
		referencedTableName="carrier" referencedColumnNames="id" />
    </changeSet>  

    <changeSet id="homework-2-freight_forwarder" author="Julia Kaiko">
        <preConditions>
            <not>
                <tableExists tableName="freightforwarder"/>
            </not>
        </preConditions>

        <createTable tableName="freightforwarder">
            <column name="id" type="BIGSERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
	    <column name="surname" type="character varying(200)">
                <constraints nullable="false"/>
            </column>
	    <column name="firstname" type="character varying(200)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="character varying(200)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="password" type="character varying(200)">
                <constraints nullable="false"/>
            </column>
    	</createTable>
    </changeSet>
    
    <changeSet id="homework-2-carriagerequest" author="Julia Kaiko">
        <preConditions>
            <not>
                <tableExists tableName="carriagerequest"/>
            </not>
        </preConditions>
        <createTable tableName="carriagerequest">
            <column name="id" type="BIGSERIAL" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
	    <column name="ordername" type="character varying (200)">
                <constraints nullable="false"/>
            </column>
	    <column name="start_point" type="character varying (200)">
                <constraints nullable="false"/>
            </column>
            <column name="finish_point" type="character varying (200)">
                <constraints nullable="false"/>
            </column>
            <column name="cargo" type="character varying (200)">
                <constraints nullable="false"/>
            </column>
            <column name="freight" type="numeric">
                <constraints nullable="false"/>
            </column>
            <column name="valid" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="forwarder_id" type="BIGINT">
                <constraints nullable="true"/>
            </column>
            <column name="manager_id" type="BIGINT">
                <constraints nullable="true"/>
            </column>
    	</createTable>
        <addForeignKeyConstraint constraintName="fk_forwarder"
                                 baseTableName="carriagerequest" baseColumnNames="forwarder_id"
                                 referencedTableName="freightforwarder" referencedColumnNames="id" />
	    <addForeignKeyConstraint constraintName="fk_carrier_manager"
		                         baseTableName="carriagerequest" baseColumnNames="manager_id"
		                         referencedTableName="carriermanager" referencedColumnNames="id" />
    </changeSet>
    
    <changeSet id="homework-2-truckpark" author="Julia Kaiko">
        <preConditions>
            <not>
                <tableExists tableName="truckpark"/>
            </not>
        </preConditions>
        <createTable tableName="truckpark">
            <column name="carrier_id" type="BIGSERIAL" autoIncrement="true">
                <constraints nullable="false" foreignKeyName="fk_truck_parks" references="carrier(id)"/>
            </column>
	    <column name="trucksnum" type="character varying (200)">
                 <constraints nullable="false"/>
            </column>
	    <column name="trucks_load_capacity" type="numeric">
                 <constraints nullable="false"/>
            </column>
    	</createTable>
    </changeSet>
    
   <changeSet id="homework-2-create indexes" author="Julia Kaiko">
        <preConditions>
            <tableExists tableName="carriermanager"/>
            <tableExists tableName="carriagerequest"/>
            <tableExists tableName="truckpark"/>
        </preConditions>
        <sql>
            CREATE INDEX my_carrierIndx ON carrier_managers (carrier_id);
            CREATE INDEX my_managerIndx ON carrier_managers (manager_id);
            CREATE INDEX my_forwarderIndx_in_carriagerequest ON carriagerequest (forwarder_id);
            CREATE INDEX my_carmanagerIndx_in_carriagerequest ON carriagerequest (manager_id);
            CREATE INDEX my_truckParkIndx ON truckpark (carrier_id);
    	</sql>
    </changeSet>
    
    <changeSet id="homework-2-carrier-fill_data" author="Julia Kaiko">
        <preConditions>
            <tableExists tableName="carrier"/>
        </preConditions>
        <sql>
            INSERT INTO carrier (name, address) VALUES ('БугТрансКонтиненталь', 'Беларусь, г.Брест, ул. Лейтенанта Рябцева, 29А');
            INSERT INTO carrier (name, address) VALUES ('КУРС', 'Россия, г.Печерск, ул. Автодорожная, 5');
            INSERT INTO carrier (name, address) VALUES ('TIRPOL', 'Польша, г.Варшава, ул. Остробрамская, 101');
    	</sql>
    </changeSet>
    
    <changeSet id="homework-2-carriermanager-fill_data" author="Julia Kaiko">
        <preConditions>
            <tableExists tableName="carriermanager"/>
        </preConditions>
        <sql>
            INSERT INTO carriermanager (surname, firstname, email, password) VALUES ('Кайко', 'Юлия', 'kaiko@gmail.com', '12345');
            INSERT INTO carriermanager (surname, firstname, email, password) VALUES ('Иванов', 'Иван', 'ivanov@gmail.com', '23456');
            INSERT INTO carriermanager (surname, firstname, email, password) VALUES ('Петров', 'Петр', 'petrov@gmail.com', '34567');
    	</sql>
    </changeSet>
    
    <changeSet id="homework-2-carrier_managers-fill_data" author="Julia Kaiko">
        <preConditions>
            <tableExists tableName="carrier_managers"/>
        </preConditions>
        <sql>
            INSERT INTO carrier_managers (manager_id, carrier_id) VALUES (1,1);
            INSERT INTO carrier_managers (manager_id, carrier_id) VALUES (1,2);
            INSERT INTO carrier_managers (manager_id, carrier_id) VALUES (1,3);
            INSERT INTO carrier_managers (manager_id, carrier_id) VALUES (2,1);
            INSERT INTO carrier_managers (manager_id, carrier_id) VALUES (2,2);
            INSERT INTO carrier_managers (manager_id, carrier_id) VALUES (3,1);
            INSERT INTO carrier_managers (manager_id, carrier_id) VALUES (3,2);
        </sql>
    </changeSet>

    <changeSet id="homework-2-freight_freightforwarder-fill_data" author="Julia Kaiko">
        <preConditions>
            <tableExists tableName="freightforwarder"/>
        </preConditions>
        <sql>
            INSERT INTO freightforwarder (surname, firstname, email, password) VALUES ('Туминас', 'Мирослав', 'tuminas@gmail.com', '111111');
            INSERT INTO freightforwarder (surname, firstname, email, password) VALUES ('Калнини', 'Диана', 'kalnini@gmail.com', '22222');
            INSERT INTO freightforwarder (surname, firstname, email, password) VALUES ('Гинтаутас', 'Екатерина', 'gintaytas@gmail.com', '33333');
        </sql>
    </changeSet>

    <changeSet id="homework-2-carriagerequest-fill_data" author="Julia Kaiko">
        <preConditions>
            <tableExists tableName="carriagerequest"/>
        </preConditions>
        <sql>
            INSERT INTO carriagerequest (ordername, start_point, finish_point, cargo, freight, valid, manager_id, forwarder_id)  VALUES ('N-12345678', 'Варшава', 'Вустермак', 'товары IKEA', 900, true, 1, 3);
            INSERT INTO carriagerequest (ordername, start_point, finish_point, cargo, freight, valid, manager_id, forwarder_id)  VALUES ('N-87654321', 'Брест', 'Москва', 'Клей', 1700, true, 2, 2);
            INSERT INTO carriagerequest (ordername, start_point, finish_point, cargo, freight, valid, manager_id, forwarder_id)  VALUES ('N-32765487', 'Можайск', 'Брест', 'Каучук', 600, true, 2, 2);
            INSERT INTO carriagerequest (ordername, start_point, finish_point, cargo, freight, valid, manager_id, forwarder_id)  VALUES ('N-85632190', 'Брест', 'Владимир', 'Конфеты', 2000, false, 3, 3);
        </sql>
    </changeSet>

     <changeSet id="homework-2-truck_parks-fill_data" author="Julia Kaiko">
        <preConditions>
            <tableExists tableName="truckpark"/>
        </preConditions>
        <sql>
            INSERT INTO truckpark (carrier_id, trucksnum, trucks_load_capacity) VALUES (1, 100, 20);
            INSERT INTO truckpark (carrier_id, trucksnum, trucks_load_capacity) VALUES (2, 10, 20);
            INSERT INTO truckpark (carrier_id, trucksnum, trucks_load_capacity) VALUES (3, 6, 20);
        </sql>
    </changeSet>

  </databaseChangeLog>
